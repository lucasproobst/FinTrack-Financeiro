{% extends 'core/base.html' %}
{% load format_filters %}
{% block title %}Dashboard{% endblock %}
{% block content %}
<div class="container py-4">

  <!-- Cabeçalho -->
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="fw-semibold">Visão Geral</h2>
  </div>

  <!-- Formulário de Exportação -->
<form method="get" action="{% url 'gerar_relatorio' %}" target="_blank" class="row g-3 align-items-end mb-4 p-3 rounded-3 shadow-sm" 
      style="background: rgba(255,255,255,0.05); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1);">

  <div class="col-md-3">
    <label for="data_inicio" class="form-label text-light">Data de Início</label>
    <input type="date" id="data_inicio" name="data_inicio" class="form-control bg-dark text-light border-secondary" required>
  </div>

  <div class="col-md-3">
    <label for="data_fim" class="form-label text-light">Data de Fim</label>
    <input type="date" id="data_fim" name="data_fim" class="form-control bg-dark text-light border-secondary" required>
  </div>

  <div class="col-md-6 d-flex gap-2">
    <button type="submit" name="formato" value="pdf" class="btn btn-outline-danger fw-semibold px-3">
      <i class="bi bi-file-earmark-pdf"></i> Exportar PDF
    </button>
    <button type="submit" name="formato" value="excel" class="btn btn-outline-success fw-semibold px-3">
      <i class="bi bi-file-earmark-excel"></i> Exportar Excel
    </button>
  </div>
</form>

  <!-- Cards de Resumo -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="mb-1 text-secondary">Receitas</h6>
            <h4 class="fw-bold text-success">R$ {{ total_receitas|abreviar_numero }}</h4>
          </div>
          <i class="bi bi-arrow-up-circle-fill fs-1 text-success"></i>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="mb-1 text-secondary">Despesas</h6>
            <h4 class="fw-bold text-danger">R$ {{ total_despesas|abreviar_numero }}</h4>
          </div>
          <i class="bi bi-arrow-down-circle-fill fs-1 text-danger"></i>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card shadow-sm h-100">
        <div class="card-body d-flex justify-content-between align-items-center">
          <div>
            <h6 class="mb-1 text-secondary">Saldo Total</h6>
            <h4 class="fw-bold text-info">R$ {{ saldo_total|abreviar_numero }}</h4>
          </div>
          <i class="bi bi-wallet-fill fs-1 text-info"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Últimos Lançamentos -->
  <div class="card shadow-sm-2 mb-4">
    <div class="card-header fw-semibold d-flex justify-content-between align-items-center" style="background: rgba(255,255,255,0.05); border: none;">
      Últimos Lançamentos
      <a href="{% url 'listar_lancamentos' %}" class="btn btn-sm btn-outline-primary">Ver Todos</a>
    </div>
    <ul class="list-group list-group-flush" style="background: transparent;">
      {% for l in ultimos_lancamentos %}
        <li class="list-group-item d-flex justify-content-between align-items-center" style="background: transparent; color: #f0f0f0; border-color: rgba(255,255,255,0.1);">
          <div class="d-flex align-items-center">
            <i class="bi {% if l.tipo == 'Receita' %}bi-arrow-down-circle-fill text-success{% else %}bi-arrow-up-circle-fill text-danger{% endif %} fs-4 me-3"></i>
            <div>
              <div class="fw-semibold">{{ l.descricao }}</div>
              <small class="text-secondary">{{ l.data|date:"d/m/Y" }} — {{ l.categoria }}</small>
            </div>
          </div>
          <span class="fw-bold {% if l.tipo == 'Receita' %}text-success{% else %}text-danger{% endif %}">
            R$ {{ l.valor|abreviar_numero }}
          </span>
        </li>
      {% empty %}
        <li class="list-group-item text-secondary" style="background: transparent; border: none;">Nenhum lançamento recente.</li>
      {% endfor %}
    </ul>
  </div>

  <!-- Saldos por Conta -->
  <div class="mb-3 d-flex justify-content-between align-items-center">
    <h4 class="fw-semibold">Contas e Saldos</h4>
    <a href="{% url 'listar_contas' %}" class="btn btn-sm btn-outline-primary">Gerenciar Contas</a>
  </div>
  <div class="row g-3">
    {% for conta in saldos_por_conta %}
    <div class="col-md-6">
      <div class="card shadow-sm h-100">
        <div class="card-body">
          <h6 class="card-title mb-1"><i class="bi bi-bank2 me-2 text-info"></i>{{ conta.nome }}</h6>
          <p class="mb-1">Saldo: <strong>R$ {{ conta.saldo|abreviar_numero }}</strong></p>
          <p class="mb-1 text-success small">Receitas: R$ {{ conta.receitas|abreviar_numero }}</p>
          <p class="mb-0 text-danger small">Despesas: R$ {{ conta.despesas|abreviar_numero }}</p>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>

</div>
{% endblock %}
